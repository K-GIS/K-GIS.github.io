<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Intro QGIS</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Intro QGIS</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#small-hands-on-on-qgis"
id="toc-small-hands-on-on-qgis">Small hands-on on QGIS</a>
<ul>
<li><a href="#discover-qgis" id="toc-discover-qgis">Discover QGIS</a>
<ul>
<li><a href="#qgis-interface" id="toc-qgis-interface">QGIS
interface</a></li>
<li><a href="#a-qgis-project" id="toc-a-qgis-project">A QGIS
project</a></li>
<li><a href="#exercises" id="toc-exercises">Exercises</a></li>
<li><a href="#open-a-wms" id="toc-open-a-wms">Open a WMS</a></li>
<li><a href="#open-the-attribute-table"
id="toc-open-the-attribute-table">Open the attribute table</a></li>
</ul></li>
</ul></li>
<li><a href="#create-a-postgis-layer-from-a-excel-table"
id="toc-create-a-postgis-layer-from-a-excel-table">Create a PostGIS
layer from a Excel table</a>
<ul>
<li><a href="#add-the-xy-data-to-qgis"
id="toc-add-the-xy-data-to-qgis">Add the XY data to QGIS</a></li>
<li><a href="#save-it-as-a-postgis-layer"
id="toc-save-it-as-a-postgis-layer">Save it as a PostGIS layer</a></li>
<li><a href="#make-a-spatial-intersection"
id="toc-make-a-spatial-intersection">Make a spatial intersection</a>
<ul>
<li><a href="#a-spatial-intersection-with-the-where-clause"
id="toc-a-spatial-intersection-with-the-where-clause">A spatial
intersection with the WHERE clause</a></li>
<li><a href="#a-spatial-intersection-with-join"
id="toc-a-spatial-intersection-with-join">A spatial intersection with
JOIN</a></li>
<li><a href="#exercise-expand-the-area-of-intersection-with-a-buffer"
id="toc-exercise-expand-the-area-of-intersection-with-a-buffer">Exercise:
expand the area of intersection with a buffer</a></li>
<li><a
href="#exercise-filter-the-observations-based-on-the-date-of-observations"
id="toc-exercise-filter-the-observations-based-on-the-date-of-observations">Exercise:
Filter the observations based on the date of observations</a></li>
</ul></li>
</ul></li>
<li><a href="#opendata-free-to-use-data-sources"
id="toc-opendata-free-to-use-data-sources">Opendata: Free to use data
sources</a>
<ul>
<li><a href="#government" id="toc-government">government</a>
<ul>
<li><a href="#geo.be-ngiign" id="toc-geo.be-ngiign">GEO.be
(NGI/IGN)</a></li>
<li><a href="#statbel.fgov.be-opendata-statistics-belgium"
id="toc-statbel.fgov.be-opendata-statistics-belgium">Statbel.fgov.be
opendata (Statistics Belgium)</a></li>
<li><a href="#others" id="toc-others">Others</a></li>
</ul></li>
<li><a href="#brussels" id="toc-brussels">Brussels</a></li>
<li><a href="#other-regions" id="toc-other-regions">Other
regions</a></li>
<li><a href="#world" id="toc-world">World</a>
<ul>
<li><a href="#openstreetmap"
id="toc-openstreetmap">Openstreetmap</a></li>
<li><a href="#natural-earth" id="toc-natural-earth">Natural
earth</a></li>
</ul></li>
<li><a href="#exercise" id="toc-exercise">Exercise</a></li>
</ul></li>
</ul>
</nav>
<h1 id="small-hands-on-on-qgis">Small hands-on on QGIS</h1>
<h2 id="discover-qgis">Discover QGIS</h2>
<h3 id="qgis-interface">QGIS interface</h3>
<figure>
<img src="../img/0_intro/interface-qgis-with-info.png"
style="width:13cm" alt="The QGIS interface" />
<figcaption aria-hidden="true">The QGIS interface</figcaption>
</figure>
<p><strong>1. Menus</strong></p>
<ul>
<li>Project: set up, open and save your current project</li>
<li>Edit: Undo, Paste etc.</li>
<li>View: Edit your map image such as zoom in and out, measure,
etc.</li>
<li>Map layers: add and manage</li>
<li>Tools: General settings</li>
<li>Plugins: install additional components</li>
<li>Database: query databases</li>
<li>Vector, Raster, Web, Meshes and processing: analysis tools</li>
<li>Help: Documentation</li>
</ul>
<p><strong>2. Toolbars</strong>: The same as in the menus, but in the
form of icons. To find out what a tool does, hover your mouse over it
and read the tooltip. To add or remove toolbars, right-click anywhere in
this area except on a disabled tool, and check or uncheck the desired
toolbars.</p>
<p><strong>3. Layer Management Toolbar</strong>: To easily add
layers.</p>
<p><strong>4. Panels</strong>:</p>
<ul>
<li>The first one: the “Browser” which allows you to easily find a file
opened by QGIS, a WMS stream, …</li>
<li>The second one: list of loaded layers, also called <strong>table of
contents</strong> (TOC). If several layers are present, you can change
the display order here. To make this area appear or disappear: View &gt;
Panels &gt; Layers</li>
<li>To add panels, View &gt; Panels</li>
</ul>
<p><strong>5. View Area</strong>. This area can be zoomed in or out.</p>
<p><strong>6. Status Bar</strong>. Here you can find the coordinates of
the point where the mouse is located, the scale…</p>
<h3 id="a-qgis-project">A QGIS project</h3>
<p>A project is a workspace. Saving a project is equivalent to saving
the list of layers used, the style used for each layer but not the
data!</p>
<p>For a layer the project only retains the path to the layer and not
the data contained in the layer.</p>
<p>You can specify relative paths or absolute paths. The advantage of
using relative paths is that you can share a file that contains the
project and its layers.</p>
<h3 id="exercises">Exercises</h3>
<h4 id="open-a-project">Open a project</h4>
<p>Open the project in the files received at the location
“projects/part_1/senegal.qgz”.</p>
<figure>
<img src="../img/0_open_pjts/0_main_windows.png" style="width:13cm"
alt="QGIS Project" />
<figcaption aria-hidden="true">QGIS Project</figcaption>
</figure>
<p>You can change the order in which the layers appear by clicking on
them and dropping it lower or higher.</p>
<figure>
<img src="../img/0_open_pjts/1_move_layer.png" style="width:13cm"
alt="QGIS Project - changing layer order" />
<figcaption aria-hidden="true">QGIS Project - changing layer
order</figcaption>
</figure>
<p>The order of the layers is important: QGIS displays the layers from
bottom to top: it draws the layer at the very bottom, then the one just
above it and so on. If you put the cities layer at the bottom of the
list, it will be hidden by the regions layer.</p>
<figure>
<img src="../img/0_open_pjts/2_villes_en_bas.png" style="width:13cm"
alt="QGIS Project - layer order changed" />
<figcaption aria-hidden="true">QGIS Project - layer order
changed</figcaption>
</figure>
<p><img src="../img/0_open_pjts/3_checkbox.png"
style="width:0.5cm" />The checkboxes in the “layers” panel allow to
display or not a layer.</p>
<figure>
<img src="../img/0_open_pjts/4_afficher_ou_non.png" style="width:13cm"
alt="QGIS project - hidden layer" />
<figcaption aria-hidden="true">QGIS project - hidden layer</figcaption>
</figure>
<p>Warning, the project file we opened did not store the data that are
displayed. It just records the path where this data is located. For
example, if we look at the details of the LOCALITIES layer, we can see
that the path to the data is
“/…links-to-exercises…/LOCALITY_P.gpkg”.</p>
<figure>
<img src="../img/0_open_pjts/5_details_couche_ville.png"
style="width:9cm" alt="QGIS Project - layer details" />
<figcaption aria-hidden="true">QGIS Project - layer details</figcaption>
</figure>
<p>We can open this layer in another project: go to the directory ”
/…links-to-exercises… /donnees/part_1/” and click on the file
“LA_LOCALITE_P.gpkg”.</p>
<p>We have another project that displays this data but in a different
style!</p>
<figure>
<img src="../img/0_open_pjts/6_couche_dans_autre_pjt.png"
style="width:13cm"
alt="QGIS project - opening the layer in a new project" />
<figcaption aria-hidden="true">QGIS project - opening the layer in a new
project</figcaption>
</figure>
<h4 id="open-a-vector-file">Open a vector file</h4>
<p>First of all, we launch QGIS and choose an empty project. When we
start QGIS, the software offers us to open recent projects. We can also
choose a new project by going to “Project” &gt; “New”.</p>
<p>We are going to open a “shapefile” which is one of the most common
vector formats.</p>
<p>In the “layer” menu, click on “add layer”, then “add vector
layer”.</p>
<figure>
<img
src="../img/0_open_vector_layer/0a_menu-layer_add-vector-layer-zoom.png"
style="width:13cm" alt="Add vector layer" />
<figcaption aria-hidden="true">Add vector layer</figcaption>
</figure>
<p>A window appears. Choose the encoding (in general, we leave UTF8 by
default).</p>
<figure>
<img
src="../img/0_open_vector_layer/1_menu-layer_add-vector-layer_window.png"
style="width:9cm" alt="Add a vector layer - choose the file" />
<figcaption aria-hidden="true">Add a vector layer - choose the
file</figcaption>
</figure>
<p>Then choose the source. In this case you have to select the desired
“.shp” file. For this exercise, open the file
“donnees/part_1/AD_2_Municipality.shp”. This data is generated by the
IGN and is available in free access on the Belgian federal portal <a
href="https://www.geo.be/#!/catalog/details/fb1e2993-2020-428c-9188-eb5f75e284b9"
class="uri">https://www.geo.be/#!/catalog/details/fb1e2993-2020-428c-9188-eb5f75e284b9</a></p>
<figure>
<img
src="../img/0_open_vector_layer/2_menu-layer_add-vector-layer_file-selection.png"
style="width:9cm" alt="Adding a vector layer - select file" />
<figcaption aria-hidden="true">Adding a vector layer - select
file</figcaption>
</figure>
<p>If all went well, the map of the municipalities of Belgium should
appear.</p>
<figure>
<img
src="../img/0_open_vector_layer/3_menu-layer_add-vector-layer_file-resultat.png"
style="width:13cm"
alt="Adding a vector layer - municipalities of Belgium" />
<figcaption aria-hidden="true">Adding a vector layer - municipalities of
Belgium</figcaption>
</figure>
<p>An alternative way to open a vector layer is to use the “Add a vector
layer” icon in the “Layer Management” toolbar.</p>
<figure>
<img
src="../img/0_open_vector_layer/0b_menu-layer_add-vector-layer-zoom.png"
style="width:9cm" alt="Add a vector layer - via toolbar icon" />
<figcaption aria-hidden="true">Add a vector layer - via toolbar
icon</figcaption>
</figure>
<h4 id="coordinate-system">Coordinate system</h4>
<p>When a first layer is added to a QGIS project, the project
automatically takes the projection system of this layer. Here, in the
case of the municipalities layer, this is the Belgian Lambert 2008
coordinate system (EPSG:3812). You can see this information in the lower
right corner of the project. Click on this button <img
src="../img/0_open_vector_layer/4_bouton_projection.png"
style="width:1.6cm" />, you will get a window to change the projection
system.</p>
<figure>
<img src="../img/0_open_vector_layer/4_project_projection.png"
style="width:9cm" alt="Change project coordinate system" />
<figcaption aria-hidden="true">Change project coordinate
system</figcaption>
</figure>
<p>You can test other coordinate systems via this window. The most
commonly used coordinate systems in GIS are:</p>
<ul>
<li>WGS 84 (EPSG:4326): projection system with longitude and latitude in
decimal degrees. Sometimes called “GPS coordinates”.</li>
<li>WGS 84 Pseudo-Mercator (EPSG: 3857): projection system based on the
Mercator projection, with the metre as unit. Often in webmaps.</li>
<li>In Belgium: Belgian Lambert 1972 (EPSG: 31370).</li>
</ul>
<p>Do this test: adding the Belgian municipalities layer in the project
“projects/part_1/senegal.qgz” or in a new blank project does not render
the same thing.</p>
<p>Do this other test: add the Belgium municipalities layer in a new
project having deleted the projection file “AD_2_Municipality.prj” from
its directory. What happens?</p>
<h3 id="open-a-wms">Open a WMS</h3>
<p>As seen before, WMS streams are web services. Rather than downloading
the whole data, we will access the data according to the location and
the zoom level. Here, we will open a WMS service to view aerial images
of the Walloon region, called “orthophotoplans”. The addresses of these
WMS services are available on the Internet.</p>
<figure>
<img src="../img/1_wms_wfs/1_wms.png" style="width:13cm"
alt="Adding a WMS layer" />
<figcaption aria-hidden="true">Adding a WMS layer</figcaption>
</figure>
<figure>
<img src="../img/1_wms_wfs/1_wms_alt.png" style="width:13cm"
alt="Adding a WMS layer - toolbar icon" />
<figcaption aria-hidden="true">Adding a WMS layer - toolbar
icon</figcaption>
</figure>
<p>In the window that appears, click on “Load” to load the file of the
connection which is in “data/part_1/WMS-SPW-ortho2018.xml”.</p>
<figure>
<img src="../img/1_wms_wfs/1_wms_b1_load.png" style="width:9cm"
alt="Adding a WMS layer" />
<figcaption aria-hidden="true">Adding a WMS layer</figcaption>
</figure>
<p>Loading will bring up data in the drop down menu. Click on “connect”
to list the layers provided by the service.</p>
<figure>
<img src="../img/1_wms_wfs/1_wms_b2_connect.png" style="width:9cm"
alt="Adding a WMS layer" />
<figcaption aria-hidden="true">Adding a WMS layer</figcaption>
</figure>
<p>The layers appear in the white area. Click on “add” to add the
selected layers to the project.</p>
<figure>
<img src="../img/1_wms_wfs/1_wms_b3_add.png" style="width:9cm"
alt="Add WMS layer" />
<figcaption aria-hidden="true">Add WMS layer</figcaption>
</figure>
<p>You should get this as a result:</p>
<figure>
<img src="../img/1_wms_wfs/1_wms_ortho.png" style="width:13cm"
alt="Adding a WMS layer - Orthophotoplans" />
<figcaption aria-hidden="true">Adding a WMS layer -
Orthophotoplans</figcaption>
</figure>
<h4 id="open-a-wfs-stream">Open a WFS stream</h4>
<p>Same procedure as for the WMS. Load the file
“data/part_1/WFS-BrusselsEnvironment.xml”.</p>
<figure>
<img src="../img/1_wms_wfs/3_wfs.png" style="width:13cm"
alt="Add a WFS layer" />
<figcaption aria-hidden="true">Add a WFS layer</figcaption>
</figure>
<figure>
<img src="../img/1_wms_wfs/4_wfs_alt.png" style="width:13cm"
alt="Adding a WFS layer - toolbar icon" />
<figcaption aria-hidden="true">Adding a WFS layer - toolbar
icon</figcaption>
</figure>
<p>Take some time to explore the layers in this WFS service and note the
difference with the WMS service.</p>
<h4 id="open-xyz-tiles">Open XYZ tiles</h4>
<p>It is also possible to add “tiled” data available on the Web. A
common practice is to add an OpenStreetMap or a satellite imagery
background to your QGIS projects in order to find your way in space.</p>
<p>These services are available in the “Browser” tab:</p>
<figure>
<img src="../img/1_wms_wfs/5_xyz_layers.png" style="width:7cm"
alt="Add a XYZ layer" />
<figcaption aria-hidden="true">Add a XYZ layer</figcaption>
</figure>
<p>The OpenStreetMap server address is:
<code>https://tile.openstreetmap.org/{z}/{x}/{y}.png</code></p>
<h3 id="open-the-attribute-table">Open the attribute table</h3>
<p>Open a new QGIS project. Add the vector layer
“/donnees/part_1/AD_2_Municipality.shp”</p>
<p>In the “Layer” menu click on “Open Attribute Table”.</p>
<figure>
<img src="../img/2_attribute_table/0a__find_in_menu.png"
style="width:13cm" alt="Reading the attribute table" />
<figcaption aria-hidden="true">Reading the attribute table</figcaption>
</figure>
<p>Another way to access it: right-click on the layer name in the layer
menu and the layer name in the layer menu and click on “Open Attribute
Table”.</p>
<figure>
<img src="../img/2_attribute_table/0b__find_in_menu.png"
style="width:13cm" alt="Read Attribute Table" />
<figcaption aria-hidden="true">Read Attribute Table</figcaption>
</figure>
<p>And the table appears.</p>
<figure>
<img src="../img/2_attribute_table/1__table.png" style="width:9cm"
alt="Attribute table" />
<figcaption aria-hidden="true">Attribute table</figcaption>
</figure>
<h4 id="selecting-elements-with-the-mouse">Selecting elements with the
mouse</h4>
<p>In the menu, click on the button.</p>
<figure>
<img src="../img/3_selection_by_mouse/0_bouton.png"
alt="Selection button" />
<figcaption aria-hidden="true">Selection button</figcaption>
</figure>
<p>You can select one or more elements on the map. They are highlighted
in blue in the attribute table.</p>
<figure>
<img src="../img/3_selection_by_mouse/1_selection.png"
style="width:13cm" alt="Feature selection in the attribute table" />
<figcaption aria-hidden="true">Feature selection in the attribute
table</figcaption>
</figure>
<p>At the bottom of the attribute table window there are options for
display options. Test them!</p>
<figure>
<img src="../img/3_selection_by_mouse/2_display_options.png"
style="width:13cm" alt="Selecting items in the attribute table" />
<figcaption aria-hidden="true">Selecting items in the attribute
table</figcaption>
</figure>
<p>Test the other selection modes by clicking on the down arrow of the
button:</p>
<figure>
<img src="../img/3_selection_by_mouse/0_bouton.png"
alt="Selection button" />
<figcaption aria-hidden="true">Selection button</figcaption>
</figure>
<h1 id="create-a-postgis-layer-from-a-excel-table">Create a PostGIS
layer from a Excel table</h1>
<p>In this section, we will create a PostGIS layer from a table of point
observations and save it as a Postgis layer.</p>
<h2 id="add-the-xy-data-to-qgis">Add the XY data to QGIS</h2>
<p>We have an Excel file of point observations over Brussels, with
coordinates of the observations in two columns (e.g., X and Y, or
longitude and latitude) and we want to add it in our PostGIS
database.</p>
<p>This is typically done by using the “Add delimited text” layer action
in the layer menu which will add the table of observations and transform
the coordinates columns into points on the map. This manipulation
requires that we convert the Excel file to a “CSV” file first, which can
be done in Excel or LibreOffice.</p>
<p>Open the Add delimited text layer dialog (Layer &gt; Add Layer &gt;
Add delimited text layer …) and browse to the csv file. The tool will
automatically detect the coordinates columns based on their names (X,
Y), but sometimes, you have to indicate the right columns for the
coordinates. It is also important to choose a coordinate system
(Geometry CRS) that is correct with respect to these coordinates!</p>
<figure>
<img src="../img/image.png" alt="Add delimited text dialog" />
<figcaption aria-hidden="true">Add delimited text dialog</figcaption>
</figure>
<p>Note: We can actually directly load the Excel file in QGIS and
transform it into points without converting to the CSV format, but this
may lead to a layer without column names, so it is not the preferred
option. But you can try: drag and drop the Excel file directly in the
layer browser of QGIS and then, use the tool “Create points layer from
table” available in the “Processing toolbox”.</p>
<p>After using the tool, the points layer will be displayed on the map,
as follows:</p>
<figure>
<img src="../img/image-1.png"
alt="Point layer displayed in the map panel" />
<figcaption aria-hidden="true">Point layer displayed in the map
panel</figcaption>
</figure>
<h2 id="save-it-as-a-postgis-layer">Save it as a PostGIS layer</h2>
<p>Save this layer to a PostGIS database is trivial once you are
connected to a PostgreSQL database with PostGIS enabled.</p>
<p>Open the DB manager (Database &gt; DB manager). Browse on the left to
the database and click on the third icon “Import Layer / File”. You can
select the layer in the first field “Input”, and then choose in which
table you want to store the database.</p>
<p>Important note! By default QGIS will propose to store the data in a
new table with the same name as the layer, but please note that you will
avoid several problems by choosing a name without special characters
(spaces, “-”, “&amp;”, etc.) and without capital letters! Although
PostgreSQL tables <em>can</em> have complicated name and users can deal
with that (by quoting the table names between ““), it is your
responsibility as a GIS manager to avoid these issues by providing
simple table names!</p>
<p>Tip: You’d better ticking the box “Create a spatial index”: though it
will take a little bit more time to create the PostGIS table, an index
will increase the performance (i.e. the speed) of reading the data for
later use.</p>
<figure>
<img src="../img/image-3.png"
alt="Import a vector layer to the database" />
<figcaption aria-hidden="true">Import a vector layer to the
database</figcaption>
</figure>
<h2 id="make-a-spatial-intersection">Make a spatial intersection</h2>
<p>Now that the observations are imported in a PostGIS table, we can
start making some spatial queries!</p>
<p>Please create a polygon in an area of interest. Here I’ve drawn a
polygon around the central station in Brussels. I’ve imported it into
the PostGIS table as seen previously. To create a polygon, you have to
create a layer (Layer &gt; Create Layer) and store it on your computer,
or you may use the QuickDraw QGIS plugin which is rather useful to
quickly create a layer from scratch.</p>
<p>Like any table, we can create a query on the observations table to
filter the data. Using PostGIS functionalities, we can create some
spatial queries.</p>
<figure>
<img src="../img/image-4.png" alt="Spatial query between 2 tables" />
<figcaption aria-hidden="true">Spatial query between 2
tables</figcaption>
</figure>
<p>To run a spatial query, open the DB manager (Database &gt; DB
manager), browse to your PostGIS database and click on the second icon
to open the query builder. On the query builder, you can type some
queries on your database. In this exercise, we want to filter all the
points that falls into the polygon we drew.</p>
<h3 id="a-spatial-intersection-with-the-where-clause">A spatial
intersection with the WHERE clause</h3>
<p>There are actually 2 ways of making a spatial intersection: (1) using
the WHERE clause and (2) using the JOIN statement. Here’s the SQL
statements to write with the WHERE clause. We use the <a
href="https://postgis.net/docs/ST_Intersects.html">PostGIS function
“ST_Intersects”</a>: this function returns “true” where there is a
spatial intersection between two layers. There are other PostGIS
functions for doing spatial intersection, such as ST_Within,
ST_Contains, ST_Disjoint, … with some subtleties in their use.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> observations.<span class="op">*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> observations, gare_centrale</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> st_intersects(gare_centrale.geom, observations.geom)</span></code></pre></div>
<p>You can load the result of the query in the QGIS map panel by
clicking on “Load”.</p>
<h3 id="a-spatial-intersection-with-join">A spatial intersection with
JOIN</h3>
<p>And here the statement using the (INNER) JOIN statement. Both queries
results in the same outputs.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> observations.<span class="op">*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> observations</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> gare_centrale <span class="kw">ON</span> st_intersects(gare_centrale.geom, observations.geom);</span></code></pre></div>
<p>To summarize, you learned how to make a simple spatial intersection
with some PostGIS function!</p>
<p>Actually this could be done using QGIS tool (select by location), but
doing it with the DB manager has some advantages:</p>
<ul>
<li>you can save your query as a SQL file to make a collection of SQL
recipes to be used and shared across colleagues.</li>
<li>more importantly, you can save the result of the query in a new
view. A view is like a table for the end-users, except the data won’t be
duplicated and will evolve with the original table.</li>
</ul>
<h3
id="exercise-expand-the-area-of-intersection-with-a-buffer">Exercise:
expand the area of intersection with a buffer</h3>
<p>Now, suppose that we want to expand a little bit the analysis by
looking at all the observations that are within a buffer zone of 100 m
around the central station polygon.</p>
<p>We could redraw a new polygon, importing it in PostGIS and re-do the
manipulation, but there is a much simple way: we can modify the query by
adding a buffer around the “gare_centrale” geometry.</p>
<!-- SELECT observations.*
FROM observations, gare_centrale
WHERE st_intersects(ST_Buffer(gare_centrale.geom, 100), observations.geom) -->
<h3
id="exercise-filter-the-observations-based-on-the-date-of-observations">Exercise:
Filter the observations based on the date of observations</h3>
<p>We want to filter the observations based on the date of observations,
keeping for instance only observations after the 01/01/2018.</p>
<!-- SELECT observations.*
FROM observations, gare_centrale
WHERE
  st_intersects(gare_centrale.geom, observations.geom)
  AND observations."creationDate" > '2018-01-01'; -->
<h1 id="opendata-free-to-use-data-sources">Opendata: Free to use data
sources</h1>
<p>Many government agencies provide a opendata-site where you can
download their free datasets.</p>
<p>Some provide services and others file formats.</p>
<h2 id="government">government</h2>
<h3 id="geo.be-ngiign"><a href="https://www.geo.be/">GEO.be</a>
(NGI/IGN)</h3>
<figure>
<img src="../img/4_opendata/geobe.png" alt="geo.be" />
<figcaption aria-hidden="true">geo.be</figcaption>
</figure>
<p>Interesting datasets: - All Belgian addresses: <a
href="https://www.geo.be/catalog/details/ca0fd5c0-8146-11e9-9012-482ae30f98d9?l=en">BestAdd</a>
- All administrative divisions of Belgium (community, province,
municipality) <a
href="https://www.geo.be/catalog/details/63b98ade-71dc-11eb-8bf5-3448ed25ad7c?l=en">Administrative
units</a> - Postalcode area’s: <a
href="https://www.geo.be/catalog/details/9738c7c0-5255-11ea-8895-34e12d0f0423?l=en">Postal
Districts</a> - Statistical divisions of Belgium: <a
href="https://www.geo.be/catalog/details/d5f503fe-c228-48a6-9f00-927c95bbd450?l=en">Statistical
sectors</a> - &gt; Used a lot in statistical reporting - NGI
WMTS-basemap: <a
href="https://www.geo.be/catalog/details/0fdbe090-bd35-41b1-8835-823eb769eaee?l=en">Cartoweb</a>
- &gt; NGI does not provide base vectordata for free. - Land Parcels: <a
href="https://www.geo.be/catalog/details/65132770-71dc-11eb-b166-3448ed25ad7c?l=en">Land
register plan</a> - &gt; ownership info not included</p>
<h3 id="statbel.fgov.be-opendata-statistics-belgium"><a
href="https://statbel.fgov.be/en/open-data">Statbel.fgov.be opendata</a>
(Statistics Belgium)</h3>
<figure>
<img src="../img/4_opendata/statbel.png" alt="Statbel.fgov.be" />
<figcaption aria-hidden="true">Statbel.fgov.be</figcaption>
</figure>
<p>Various statistics of Belgium, like fiscal incomes, population, …</p>
<p>Mostly flat tables (.csv) or excel-files, usually reported on
municipal of statistical sector level.</p>
<p>Using GIS-data from NGI/IGN you can join these tables to make maps
with these datasets.</p>
<h3 id="others">Others</h3>
<ul>
<li>MIVB: <a href="https://opendata.stib-mivb.be/store/data"
class="uri">https://opendata.stib-mivb.be/store/data</a></li>
<li>De lijn: <a href="https://data.delijn.be"
class="uri">https://data.delijn.be</a></li>
<li>Infrabel (trains): <a href="https://opendata.infrabel.be"
class="uri">https://opendata.infrabel.be</a></li>
<li>Fluvius (energy): <a href="https://opendata.fluvius.be"
class="uri">https://opendata.fluvius.be</a></li>
<li>Bosa: <a href="https://data.gov.be"
class="uri">https://data.gov.be</a></li>
</ul>
<h2 id="brussels">Brussels</h2>
<figure>
<img src="../img/4_opendata/datastore.png" alt="datastore.brussels" />
<figcaption aria-hidden="true">datastore.brussels</figcaption>
</figure>
<ul>
<li>Geoportal of the Brussels Capital Region <a
href="http://Geo.brussels">Geo.brussels</a></li>
<li>Brussels open data site <a
href="https://datastore.brussels">datastore.brussels</a>
<ul>
<li><blockquote>
<p>useful to share with external contacts</p>
</blockquote></li>
</ul></li>
</ul>
<h2 id="other-regions">Other regions</h2>
<ul>
<li>Flanders:
<ul>
<li><a href="https://www.geopunt.be/catalogus">geopunt.be</a></li>
<li><a
href="https://provincies.incijfers.be/">provincies.incijfers.be</a></li>
</ul></li>
<li>Walonia: <a
href="https://geoportail.wallonie.be/">geoportail.wallonie.be</a></li>
</ul>
<h2 id="world">World</h2>
<h3 id="openstreetmap">Openstreetmap</h3>
<p>Openstreetmap is a free base map of the world created by hobbyists.
QGIS already includes this map under <code>XYZ-tiles</code>. This is
only the rendered tiles, not the source data.</p>
<p>Retrieving the openstreetmap source data is quite complicated. The
German company geofabrik provides downloads for each country, in the
original openstreetmap format (.osm.pbf) and in shapefile format, useful
in QGIS if you need basic data from other countries.</p>
<p>The European downloads can be found here: <a
href="https://download.geofabrik.de/europe.html"
class="uri">https://download.geofabrik.de/europe.html</a></p>
<h3 id="natural-earth">Natural earth</h3>
<p>Natural earth contains the basis if you want to make maps on a global
scale. It includes administrative boundaries, larger water bodies,
etc.</p>
<p>You can find the download here: <a
href="https://www.naturalearthdata.com/downloads/"
class="uri">https://www.naturalearthdata.com/downloads/</a></p>
<h2 id="exercise">Exercise</h2>
<ul>
<li>On the Statbel site <a href="https://statbel.fgov.be/nl/open-data/"
class="uri">https://statbel.fgov.be/nl/open-data/</a>
<ul>
<li>Search and download the statistical sectors of Belgium as
<em>shapefile (.shp)</em></li>
<li>Extract the zip file and add it to qgis.</li>
<li>Search “Population by Statistical Sector” and download it as a text
file.</li>
<li>Add it to qgis using the delimited text tool.</li>
<li>Connect both data sources using:
<ol type="1">
<li>Right-click on the Statistical Sectors layer</li>
<li>Choose “Properties”</li>
<li>Choose “Joins” and then click the plus sign</li>
<li>Connect the sectors on field “CD_SECTOR” Population on field
“CD_SECTOR”</li>
<li>Color the polygons of the sectors with the field TOTAL (=number of
people) of population</li>
</ol></li>
</ul></li>
</ul>
<figure>
<img src="../img/4_opendata/joins.png" alt="Joins in QGIS" />
<figcaption aria-hidden="true">Joins in QGIS</figcaption>
</figure>
</body>
</html>
